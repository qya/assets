const fVars=JSON.parse(new URL(location).searchParams.get("params"));var notification_timeout,_version=fVars.V,BBCODES=fVars.BBCODES,THEME=fVars.THEME,HOST=fVars.HOST,db=new Dexie("vy_ms_store_vars");db.version(1).stores({global_vars:"id,_var,_value,_timestamp"});const cache_assets="vy_ms_assets_cache",staticAssets=["./app.js","./themes/"+THEME+"/javascript/core.js?v="+_version,"./themes/"+THEME+"/javascript/jquery-3.1.1.min.js?v="+_version,"./themes/"+THEME+"/stylesheet/glyph.css?v="+_version,"./themes/"+THEME+"/stylesheet/style.css?v="+_version,"./themes/"+THEME+"/javascript/vaneayoung/clipboard.min.js?v="+_version,"./themes/"+THEME+"/javascript/vaneayoung/easytimer.min.js?v="+_version,"./themes/"+THEME+"/javascript/vaneayoung/liveNotifications.js?v="+_version,"./themes/"+THEME+"/javascript/vaneayoung/messenger-shortcut.js?v="+_version,"./themes/"+THEME+"/javascript/vaneayoung/messenger.js?v="+_version,"./themes/"+THEME+"/javascript/vaneayoung/peer.min.js?v="+_version,"./themes/"+THEME+"/javascript/vaneayoung/recorder.js?v="+_version,"./themes/"+THEME+"/javascript/vaneayoung/socket.io-1.2.0.js?v="+_version,"./themes/"+THEME+"/javascript/vaneayoung/soundmanager2-jsmin.js?v="+_version,"./themes/"+THEME+"/javascript/vaneayoung/system.js?v="+_version,"./themes/"+THEME+"/javascript/vaneayoung/tinysort.min.js?v="+_version,"./themes/"+THEME+"/javascript/vaneayoung/webrtc-calls.js?v="+_version,"./themes/"+THEME+"/javascript/vaneayoung/confirm-dialog/js/jquery-confirm.min.js?v="+_version,"./themes/"+THEME+"/javascript/vaneayoung/confirm-dialog/css/jquery-confirm.min.css?v="+_version,"./themes/"+THEME+"/javascript/vaneayoung/emojiarea/dist/emojionearea.min.css?v="+_version,"./themes/"+THEME+"/javascript/vaneayoung/emojiarea/dist/emojionearea.min.js?v="+_version,"./themes/"+THEME+"/javascript/vaneayoung/emojiarea/dist/joypixels.min.js?v="+_version,"./themes/"+THEME+"/javascript/vaneayoung/lightgallery/css/lightgallery.min.css?v="+_version,"./themes/"+THEME+"/javascript/vaneayoung/lightgallery/js/lightgallery.min.js?v="+_version,"./themes/"+THEME+"/javascript/vaneayoung/nanoScroll/css/nanoscroller.css?v="+_version,"./themes/"+THEME+"/javascript/vaneayoung/nanoScroll/javascripts/overthrow.min.js?v="+_version,"./themes/"+THEME+"/javascript/vaneayoung/nanoScroll/javascripts/jquery.nanoscroller.min.js?v="+_version,"./themes/"+THEME+"/javascript/vaneayoung/timeago.min.js?v="+_version];function serializeRequest(e){return e.clone().text().then(function(t){return Promise.resolve(md5(t+"_"+e.referrer))})}function serializeResponse(e){var t={headers:serializeHeaders(e.headers),status:e.status,statusText:e.statusText};return e.clone().text().then(function(e){return t.body=e,Promise.resolve(t)})}function serializeHeaders(e){var t={};for(var a of e.entries())t[a[0]]=a[1];return t}function deserializeResponse(e){return Promise.resolve(new Response(e.body,e))}async function cachePut(e,t,a){var n;await getPostId(e).then(function(e){return n=e,serializeResponse(t.clone())}).then(function(e){var t={key:n,response:e,timestamp:Date.now()};a.add(t).catch(function(e){a.update(t.key,t)})})}async function cacheMatch(e,t){return await getPostId(e).then(function(e){return t.get(e)}).then(function(e){return e?deserializeResponse(e.response):new Response("",{status:503,statusText:"Service Unavailable"})})}async function getPostId(e){return serializeRequest(e.clone())}function md5cycle(e,t){var a=e[0],n=e[1],i=e[2],o=e[3];a=ff(a,n,i,o,t[0],7,-680876936),o=ff(o,a,n,i,t[1],12,-389564586),i=ff(i,o,a,n,t[2],17,606105819),n=ff(n,i,o,a,t[3],22,-1044525330),a=ff(a,n,i,o,t[4],7,-176418897),o=ff(o,a,n,i,t[5],12,1200080426),i=ff(i,o,a,n,t[6],17,-1473231341),n=ff(n,i,o,a,t[7],22,-45705983),a=ff(a,n,i,o,t[8],7,1770035416),o=ff(o,a,n,i,t[9],12,-1958414417),i=ff(i,o,a,n,t[10],17,-42063),n=ff(n,i,o,a,t[11],22,-1990404162),a=ff(a,n,i,o,t[12],7,1804603682),o=ff(o,a,n,i,t[13],12,-40341101),i=ff(i,o,a,n,t[14],17,-1502002290),a=gg(a,n=ff(n,i,o,a,t[15],22,1236535329),i,o,t[1],5,-165796510),o=gg(o,a,n,i,t[6],9,-1069501632),i=gg(i,o,a,n,t[11],14,643717713),n=gg(n,i,o,a,t[0],20,-373897302),a=gg(a,n,i,o,t[5],5,-701558691),o=gg(o,a,n,i,t[10],9,38016083),i=gg(i,o,a,n,t[15],14,-660478335),n=gg(n,i,o,a,t[4],20,-405537848),a=gg(a,n,i,o,t[9],5,568446438),o=gg(o,a,n,i,t[14],9,-1019803690),i=gg(i,o,a,n,t[3],14,-187363961),n=gg(n,i,o,a,t[8],20,1163531501),a=gg(a,n,i,o,t[13],5,-1444681467),o=gg(o,a,n,i,t[2],9,-51403784),i=gg(i,o,a,n,t[7],14,1735328473),a=hh(a,n=gg(n,i,o,a,t[12],20,-1926607734),i,o,t[5],4,-378558),o=hh(o,a,n,i,t[8],11,-2022574463),i=hh(i,o,a,n,t[11],16,1839030562),n=hh(n,i,o,a,t[14],23,-35309556),a=hh(a,n,i,o,t[1],4,-1530992060),o=hh(o,a,n,i,t[4],11,1272893353),i=hh(i,o,a,n,t[7],16,-155497632),n=hh(n,i,o,a,t[10],23,-1094730640),a=hh(a,n,i,o,t[13],4,681279174),o=hh(o,a,n,i,t[0],11,-358537222),i=hh(i,o,a,n,t[3],16,-722521979),n=hh(n,i,o,a,t[6],23,76029189),a=hh(a,n,i,o,t[9],4,-640364487),o=hh(o,a,n,i,t[12],11,-421815835),i=hh(i,o,a,n,t[15],16,530742520),a=ii(a,n=hh(n,i,o,a,t[2],23,-995338651),i,o,t[0],6,-198630844),o=ii(o,a,n,i,t[7],10,1126891415),i=ii(i,o,a,n,t[14],15,-1416354905),n=ii(n,i,o,a,t[5],21,-57434055),a=ii(a,n,i,o,t[12],6,1700485571),o=ii(o,a,n,i,t[3],10,-1894986606),i=ii(i,o,a,n,t[10],15,-1051523),n=ii(n,i,o,a,t[1],21,-2054922799),a=ii(a,n,i,o,t[8],6,1873313359),o=ii(o,a,n,i,t[15],10,-30611744),i=ii(i,o,a,n,t[6],15,-1560198380),n=ii(n,i,o,a,t[13],21,1309151649),a=ii(a,n,i,o,t[4],6,-145523070),o=ii(o,a,n,i,t[11],10,-1120210379),i=ii(i,o,a,n,t[2],15,718787259),n=ii(n,i,o,a,t[9],21,-343485551),e[0]=add32(a,e[0]),e[1]=add32(n,e[1]),e[2]=add32(i,e[2]),e[3]=add32(o,e[3])}function cmn(e,t,a,n,i,o){return t=add32(add32(t,e),add32(n,o)),add32(t<<i|t>>>32-i,a)}function ff(e,t,a,n,i,o,s){return cmn(t&a|~t&n,e,t,i,o,s)}function gg(e,t,a,n,i,o,s){return cmn(t&n|a&~n,e,t,i,o,s)}function hh(e,t,a,n,i,o,s){return cmn(t^a^n,e,t,i,o,s)}function ii(e,t,a,n,i,o,s){return cmn(a^(t|~n),e,t,i,o,s)}function md51(e){txt="";var t,a=e.length,n=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)md5cycle(n,md5blk(e.substring(t-64,t)));e=e.substring(t-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)i[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),t>55)for(md5cycle(n,i),t=0;t<16;t++)i[t]=0;return i[14]=8*a,md5cycle(n,i),n}function md5blk(e){var t,a=[];for(t=0;t<64;t+=4)a[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return a}self.addEventListener("install",async e=>{const t=await caches.open(cache_assets);await t.addAll(staticAssets)}),self.addEventListener("fetch",function(e){if("POST"===e.request.method&&!e.request.url.includes("checklogin.php")){var t=new Dexie("post_cache");t.version(1).stores({post_cache:"key,response,timestamp"}),e.respondWith(fetch(e.request.clone()).then(function(a){return cachePut(e.request.clone(),a.clone(),t.post_cache),a}).catch(function(){return cacheMatch(e.request,t.post_cache)}))}});var hex_chr="0123456789abcdef".split("");function rhex(e){for(var t="",a=0;a<4;a++)t+=hex_chr[e>>8*a+4&15]+hex_chr[e>>8*a&15];return t}function hex(e){for(var t=0;t<e.length;t++)e[t]=rhex(e[t]);return e.join("")}function md5(e){return hex(md51(e))}function add32(e,t){return e+t&4294967295}if("5d41402abc4b2a76b9719d911017c592"!=md5("hello"))function add32(e,t){var a=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(a>>16)<<16|65535&a}function isValidImageURL(e){return"string"==typeof e&&!!e.match(/\w+\.(jpg|jpeg|gif|png|tiff|bmp)$/gi)}function _json_valid(e){return!!/^[\],:{}\s]*$/.test(e.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))}async function settings(){let e=await getVarIndb("V_EMOJIS"),t=await getVarIndb("LANG"),a=await getVarIndb("_emojiVersion"),n=(await getVarIndb("_emojiDefaultSize"),e+a+"/png/unicode/32/");return{notif_timeout:999999,notif_vibrate:[200],notif_icon:"auto",notif_renotify:!0,notif_silent:!1,reaction_default_btn:"seen",buttons:{btn_accept_invitation:{title:t.BTN_JOIN,action:"join_group"},btn_decline_invitation:{title:t.BTN_DECLINE,action:"decline_group_invitation"},btn_seen:{title:t.BTN_SEEN,action:"seen",icon:n+"1f441.png"},btn_like:{title:t.BTN_LIKE,action:"like",icon:n+"1f44d.png"},btn_reply:{title:t.BTN_REPLY,action:"reply",icon:n+"270d.png"},btn_mute:{title:t.BTN_MUTE+" %s",action:"mute",icon:n+"1f507.png"},btn_hide:{title:t.BTN_HIDE,action:"hide",icon:""},btn_change_nicknames:{title:t.BTN_CHANGE_NICKNAMES,action:"change_nicknames",icon:""},btn_change_color:{title:t.BTN_CHANGE_COLOR,action:"change_color",icon:""}}}}async function containsBBCODE(e){let t=await getVarIndb("BBCODES");if(!_json_valid(t))return!1;t=JSON.parse(t);let a=!1;for(var n=0;n<t.length;n++)e.includes(t[n])&&(a=!0);return a}async function vy_ms_livemedia(e,t,a){let n={error:null,msg:e},i={},o=await getVarIndb("HOST");return i.cmd="bbcode",i.json_format="yes",i.string=e,i.dmurl="yes",t&&(i.min="yes"),a&&(i.ot="yes"),await fetch(o+"/messenger.php",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:gparams(i)}).then(async function(e){200===e.status?await e.json().then(function(e){n.msg=e}):n.error="[bb] Looks like there was a problem. Status Code: "+e.status}).catch(function(e){n.error="[bb] Fetch Error :-S "+e}),n.error&&console.log(n.error),n}async function generateUrl(e){let t=e.msg_data,a=e.user_data,n=await getVarIndb("HOST")+"/messenger",i=a.hasOwnProperty("id")?a.id:a.i;return t.group_id>0?n+="/g/"+t.group_id:t.page_id>0?n+="/"+i+"/"+t.page_id:n+="/"+i,n}async function _showGroupNotification(e,t){let a=await settings(),n=t.group_data.Group_data,i=n.group_avatar,o=n.group_name,s=(n.group_owner,_num(t.group_data.Group_clean_id)),r="vy_ms__push_group_"+s,c="unknown message",u=await getVarIndb("HOST")+"/messenger/g/"+s;t.msg_data={group_id:s},t.user_data={id:0};let d={action:a.buttons.btn_mute.action,title:a.buttons.btn_mute.title.replace("%s","group"),icon:a.buttons.btn_mute.icon},_={action:a.buttons.btn_hide.action,title:a.buttons.btn_hide.title},g=[_,d];switch(t.group_data.categ){case"nickname-updated":c=t.group_data.nickname_removed?`${t.group_data.User.fn} ${LANG.REMOVED_HIS_NICKNAME}.`:`${t.group_data.User.fn} ${LANG.UPDATED_NICKNAME}: ${t.group_data.Nickname}`;break;case"group-cleaned":c=`${t.group_data.User.fn} ${LANG.CLEANED_THE_GROUP}`;break;case"you-re-removed-from-group":c=`${t.group_data.User.fn} ${LANG.REMOVED_YOU_FROM_GROUP}.`,g=[_];break;case"invited-you-in-a-group":c=`${t.group_data.User.fn} ${LANG.SENT_YOU_GROUP_INVITATION} ${o}`,g=[_={action:a.buttons.btn_accept_invitation.action,title:a.buttons.btn_accept_invitation.title},d={action:a.buttons.btn_decline_invitation.action,title:a.buttons.btn_decline_invitation.title}];break;case"group-color-changed":c=`${t.group_data.User.fn} ${LANG.UPDATED_CHAT_COLOR}.`;break;case"react":let e=reaction_emojis(t.group_data.Data.notif.reaction);c=`${t.group_data.Data.user.fn} ${LANG.REACTED} ${e} ${LANG.TO_YOUR_MESSAGE}.`}let l={body:c,icon:"auto"==a.notif_icon?i:a.notif_icon,actions:g,data:{url:u,data:t},vibrate:a.notif_vibrate,timeout:a.notif_timeout,tag:r,badge:i,dir:"auto",lang:"Unicode",renotify:a.notif_renotify,silent:a.notif_silent,timestamp:Date.now()};return closeNotif(r),send_Push(e,t,l,o)}async function _showNotification(e,t,a){let n=await settings(),i=a.user_data.group>0?a.user_data.group_avatar:a.user_data.hasOwnProperty("avatar")?a.user_data.avatar:a.user_data.p,o=await generateUrl(a),s=a.user_data.group>0?"vy_ms__push_group_"+a.user_data.group:"vy_ms__push_uid_"+(a.user_data.page?a.user_data.id+"_"+a.user_data.page:a.user_data.id),r="seen"==n.reaction_default_btn?n.buttons.btn_seen:n.buttons.btn_like,c=a.user_data.group>0?a.user_data.group_name:a.user_data.hasOwnProperty("fullname")?a.user_data.fullname:a.user_data.fn,u=a.user_data.group>0?a.user_data.fullname+": "+t.msg:t.msg,d=await getVarIndb("LANG");null!=a.msg_data.reply&&(u=a.user_data.group>0?a.user_data.fullname+" "+d.REPLIED+": "+t.msg:d.REPLIED+": "+t.msg);let _=null,g=null,l={action:n.buttons.btn_hide.action,title:n.buttons.btn_hide.title},m={action:n.buttons.btn_change_color.action,title:n.buttons.btn_change_color.title},p={action:n.buttons.btn_change_nicknames.action,title:n.buttons.btn_change_nicknames.title};a.user_data.page>0&&(c=a.user_data.page_name.match(/\((.*?)\)/g)&&"yes"==a.user_data.page_admin?a.user_data.page_name.match(/\((.*?)\)/g).map(e=>e.replace(/\(|(.*?)\)/g,"$1")):a.user_data.fullname+" ("+a.user_data.page_name+")");let f={action:r.action,title:r.title,icon:r.icon},h={action:n.buttons.btn_mute.action,title:n.buttons.btn_mute.title.replace("%s",a.user_data.group>0?"group":a.user_data.fullname)};if((a.user_data.group>0||a.user_data.page>0)&&(f={action:n.buttons.btn_reply.action,title:n.buttons.btn_reply.title,icon:n.buttons.btn_reply.icon}),a.user_data.page>0&&(h=l),a.notif_data.hasOwnProperty("categ"))switch(a.notif_data.categ){case"nickname_added":_=[p,l],a.additional_action="change_nicknames",trim(a.notif_data.nickname1)&&trim(a.notif_data.nickname2)?u=`${a.user_data.fn} ${d.YOUR_NICKNAME} ${a.notif_data.nickname1} ${d.HIS_NICKNAME} ${a.notif_data.nickname2}.`:trim(a.notif_data.nickname1)&&!trim(a.notif_data.nickname2)?u=`${a.user_data.fn} ${d.YOUR_NICKNAME} ${a.notif_data.nickname1}.`:!trim(a.notif_data.nickname1)&&trim(a.notif_data.nickname2)&&(u=`${a.user_data.fn} ${d.UPDATED_NICKNAME} ${a.notif_data.nickname2}.`);break;case"nickname_cleared":u=`${d.CLEARED_NICKNAMES}.`,_=[l],a.additional_action="change_nicknames";break;case"color_changed":u=`${d.UPDATED_CHAT_COLOR}.`,_=[m,l],a.additional_action="change_color";break;case"react":let e=reaction_emojis(a.notif_data.reaction);u=`${a.user_data.fn} ${d.REACTED} ${e} ${d.TO_YOUR_MESSAGE}.`,_=[l]}g={url:o,data:a};let v=_||[f,h],b={body:u,icon:"auto"==n.notif_icon?i:n.notif_icon,actions:v,data:g,vibrate:n.notif_vibrate,timeout:n.notif_timeout,tag:s,badge:i,dir:"auto",lang:"Unicode",renotify:n.notif_renotify,silent:n.notif_silent,timestamp:Date.now()};return t.direct_url&&(b.image=t.direct_url),closeNotif(s),send_Push(e,a,b,c)}function reaction_emojis(e){let t="❤️‍";switch(e){case"like":t="❤️‍";break;case"haha":t="😂";break;case"wow":t="😮";break;case"sad":t="😭";break;case"angry":t="😡"}return t}function trim(e){return e.replace(/^\s+|\s+$/g,"")}function closeNotif(e){self.registration.getNotifications().then(t=>{t.forEach(function(t){t.tag==e&&t.close()})})}async function send_Push(e,t,a,n){let i=await settings();notification_timeout&&clearTimeout(notification_timeout),clients.matchAll({includeUncontrolled:!0,type:"window"}).then(e=>{for(var t=!1,o=0;o<e.length;o++){"visible"===e[o].visibilityState&&(t=!0)}t||self.registration.showNotification(decodeURIComponent(n),a).then(function(){notification_timeout=setTimeout(function(){closeNotif(a.tag)},i.notif_timeout)})})}async function acceptGroupInvitation(e,t,a){let n=await getVarIndb("_U"),i={cmd:"accept-group-invitation",id:escape(n.i),group:escape(_num(e.group_data.Group_clean_id))};fetch(HOST+"/messenger.php",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:gparams(i)}).then(async function(i){200===i.status?await i.json().then(function(o){if("1"==o.success){t.group_data=JSON.stringify({Room_id:socketId("GG"+_num(e.group_data.Group_clean_id)),Userid:socketId(n.i),Userid_clean:n.i,Group_id_clean:_num(e.group_data.Group_clean_id)});for(var s=0;s<a.length;s++)"focus"in a[s]&&a[s].postMessage(t)}else console.log("[ERROR accept-group-invitation] "+i.msg)}):console.log("[accept-group-invitation] Looks like there was a problem. Status Code: "+i.status)}).catch(function(e){console.error("[Join Group Fetch Error]"+e)})}async function declineGroupInvitation(e,t,a){let n=await getVarIndb("_U"),i={cmd:"ignore-group-invitation",id:escape(n.i),group:escape(_num(e.group_data.Group_clean_id))};fetch(HOST+"/messenger.php",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:gparams(i)}).then(async function(i){200===i.status?await i.json().then(function(o){if("1"==o.success){t.group_data=JSON.stringify({Room_id:socketId("GG"+_num(e.group_data.Group_clean_id)),Userid:socketId(n.i),Userid_clean:n.i,Group_id_clean:_num(e.group_data.Group_clean_id),own_exit:1});for(var s=0;s<a.length;s++)"focus"in a[s]&&a[s].postMessage(t)}else console.log("[ERROR accept-group-invitation] "+i.msg)}):console.log("[accept-group-invitation] Looks like there was a problem. Status Code: "+i.status)}).catch(function(e){console.error("[Join Group Fetch Error]"+e)})}function randomId(){return Date.now()+Math.floor(99*Math.random())}async function getVarIndb(e){return await db.global_vars.where("id").equals(e).toArray(function(e){return e[e.length-1]._value})}async function socketId(e){let t=await getVarIndb("_U");return md5(await getVarIndb("V_WS_ADDR")+"_"+(e||t.i))}function gparams(e){return Object.keys(e).map(t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t])).join("&")}async function sendMessage(e,t){let a=t.msg_data,n=t.user_data.id,i={},o=await getVarIndb("HOST"),s=await getVarIndb("VY_SERV_URL"),r=await getVarIndb("_U"),c=n+"__"+randomId(),u={msg:{},user:{}},d=randomId(),_=new Date,g=_.getMinutes()>=10?_.getMinutes():"0"+_.getMinutes();u.msg.id=d,u.msg.msgid=d,u.msg.text=e,u.msg.min_text=e,u.msg.page_id=a.page_id?a.page_id:0,u.msg.group_id=a.group_id?a.group_id:0,u.msg.rd="no",u.msg.read="no",u.msg.seen="0",u.msg.bg="no",u.msg.time=_.getHours()+":"+g,u.msg.timestamp=(new Date).getTime(),u.msg.curr_date=(new Date).getDate(),u.msg.count=1,u.msg.recipient=n,u.user.id=r.i,u.user.socketid=socketId(r.i),u.user.fullname=r.fn,u.user.avatar=r.p,u.user.online_ago=1,u.user.online=1,setTimeout(async function(){a.group_id>0?await fetch(s+"/pushmessage",{method:"POST",body:JSON.stringify({msg_data:{Group_id:await socketId("GG"+a.group_id),From:await socketId(r.i),Data:u,Hash:c},event:"vy_ms__group_message"}),headers:{"Content-Type":"application/json"}}):await fetch(s+"/pushmessage",{method:"POST",body:JSON.stringify({msg_data:{Userid:await socketId(n),From:await socketId(r.i),Data:u,Hash:c},event:"vy_new_message"}),headers:{"Content-Type":"application/json"}})},10),i.id=d,i.cmd="sendMessage",i.bg="no",i.text=e,i.view_as="json",i.userid=n,a.page_id&&(i.page=escape(a.page_id)),a.group_id>0&&(i.group=escape(a.group_id)),fetch(o+"/messenger.php",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:gparams(i)}).then(async function(e){200===e.status?await e.json().then(function(e){console.log("Seen sent",e)}):console.log("[seen] Looks like there was a problem. Status Code: "+e.status)}).catch(function(e){console.error("Seen Fetch Error :-S "+e)})}async function muteContact(e,t,a){let n=await getVarIndb("_U"),i=await getVarIndb("VY_SERV_URL"),o=e.msg_data,s=e.user_data.id,r={cmd:"mute-contact",recipient:escape(s),interval:"99"};o.group_id>0&&(r.group=escape(o.group_id)),fetch(HOST+"/messenger.php",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:gparams(r)}).then(async function(e){200===e.status?await e.json().then(function(e){t.mute_data=e.new_arr;for(var r=0;r<a.length;r++)"focus"in a[r]&&a[r].postMessage(t);setTimeout(async function(){await fetch(i+"/mute",{method:"POST",body:JSON.stringify({user_id:await socketId(n.i),user_clean_id:n.i,recipient_clean_id:o.group_id?o.group_id:s,recipient_id:await socketId(n.i),group_id:o.group_id?await socketId("GG"+o.group_id):0,group_clean_id:parseInt(o.group_id),value:"99",cron:null,timezone:await getTimezone()}),headers:{"Content-Type":"application/json"}})},50)}):console.log("[mute] Looks like there was a problem. Status Code: "+e.status)}).catch(function(e){console.error("[Muted Fetch Error]"+e)})}async function getTimezone(){return await getVarIndb("vy_ms_timezone")}function getLocalTimezone(){return Intl.DateTimeFormat().resolvedOptions().timeZone}function _num(e){return/[a-zA-Z]/g.test(e)&&(e=e.match(/\d/g).join("")),e}self.addEventListener("message",async function(e){for(i in e.data)await db.global_vars.put({id:i,_var:i,_value:e.data[i],_timestamp:Date.now()})}),self.addEventListener("push",async function(e){const t=e.data.json();if(Object.keys(t.group_data).length&&t.group_data.hasOwnProperty("Group_clean_id")&&_num(t.group_data.Group_clean_id)>0)return _showGroupNotification(e,t);let a=t.msg_data,n=a.text.replace(/&amp;/g,"&"),i={msg:n,direct_url:""};("no"==a.bg||await containsBBCODE(n))&&await vy_ms_livemedia(n,1,1).then(function(e){i.msg=e.msg.str,i.direct_url=e.msg.direct_url}),_showNotification(e,i,t)}),self.addEventListener("notificationclick",function(e){let t=e.notification.data.url,a=e.notification.data.data;e.notification.close(),e.waitUntil(clients.matchAll({includeUncontrolled:!0}).then(n=>{let i={action:e.action,url:t,data:a};switch(e.action){case"seen":sendMessage("👁️",a);break;case"like":sendMessage("👍",a);break;case"mute":i.action="mute",muteContact(a,i,n);break;case"hide":e.notification.close();break;case"decline_group_invitation":declineGroupInvitation(a,i,n);break;case"join_group":acceptGroupInvitation(a,i,n);break;case"change_color":case"change_nicknames":case"reply":case"":default:i.action="openContact";for(var o=0;o<n.length;o++){var s=n[o];if("focus"in s)return s.url!==t?s.postMessage(i):(i.action="scroll",s.postMessage(i)),"change_nicknames"==e.action&&(i.additional_action="open_nicknames"),"change_color"==e.action&&(i.additional_action="open_colors"),s.focus()}if(clients.openWindow)return clients.openWindow(t)}}))},!1);