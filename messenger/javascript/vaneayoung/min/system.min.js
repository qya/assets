var call_user_answered,ms__new_message,ms__tap,ms__send_message,ms__incomming_call,ms__ringing_sound,ms__contacting_sound,ms__error_sound,beforeUnloadTimeout=0,global_messenger_count=0,gl_scrollChatDelay=!1,vy_ms__mob_last_window_focus=(new Date).getTime(),newCallWindow={},hasTouchStartEvent=is_smartphone(),VY_USER_FN=$.trim(_U.first_name)?_U.first_name:_U.username,call_confirm_popup={close:function(){}},messenger__sort_reaction=function(){},vy_xhr={},ms_muted_contacts=vy_ms_mdcontacts||new Array,_ms_Cache={data:{},remove:function(e){delete _ms_Cache.data[e]},exist:function(e){return _ms_Cache.data.hasOwnProperty(e)&&null!==_ms_Cache.data[e]},get:function(e){return console.log("Getting in cache for url"+e),_ms_Cache.data[e]},set:function(e,n,o){_ms_Cache.remove(e),_ms_Cache.data[e]=n,$.isFunction(o)&&o(n)}};function __j(e){return $(e)}function arr_prepend(e,n){var o=n.slice();return o.unshift(e),o}function merge_options(e,n){var o={};for(var t in e)o[t]=e[t];for(var t in n)o[t]=n[t];return o}function reverseObject(e){var n={},o=[];for(var t in e)o.push(t);for(var r=o.length-1;r>=0;r--){var a=e[o[r]];n[o[r]]=a}return n}function isEven(e){return e%2==0}function generateRoomId(e,n,o,t){return o=o||0,t=t||0,e=parseInt(e),n=parseInt(n),o?e*n+e+n+"_"+o:t>0?"GG"+t:e*n+e+n}function nl2br(e,n){return(e+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+(n||void 0===n?"<br />":"<br>")+"$2")}function _jAjax(e,n,o,t,r){let a;return r||(r=Math.floor(99*Math.random())),(a=t?$.ajax({url:e,type:n,data:o,cache:!1,contentType:!1,processData:!1}):$.ajax({url:e,type:n,data:o,beforeSend:function(e,n){vy_xhr[r]=e}})).fail(function(e,n){}),a}function jAjax(e,n,o,t,r,a){return _ms_Cache.exist(a)?{localcache:!0,data:_ms_Cache.get(a)}:_jAjax(e,n,o,t,r)}function createCookie(e,n,o){if(o||(o=100),o){var t=new Date;t.setTime(t.getTime()+24*o*60*60*1e3);var r="; expires="+t.toGMTString()}else r="";document.cookie=e+"="+n+r+"; path=/"}function readCookie(e){for(var n=e+"=",o=document.cookie.split(";"),t=0;t<o.length;t++){for(var r=o[t];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(n))return r.substring(n.length,r.length)}return null}function evstop(e,n){n&&e.preventDefault(),e.stopImmediatePropagation()}function Wo_OpenChatTab(e,n,o=0,t=0,r=0){let a=__j("html").hasClass("messenger-window");n&&a&&(window.location="/messenger/g/"+n)}function vy_openChatTab(e,n,o,t){let r=void 0!==(e=__j(e)).data("uch").group&&parseInt(e.data("uch").group),a=void 0!==e.data("uch").page_id&&parseInt(e.data("uch").page_id);current_width<720||__j("html").hasClass("vy-shortcut-hidden")||is_smartphone()?window.location=r>0?"/messenger/g/"+r:a>0?"/messenger/"+o+"/"+a:"/messenger/"+o:(messenger.closeBox(),messenger_shortcut.open(e,n))}function messengerPage(){__j(".pmessenger").length?!__j("html").hasClass("messenger-window")&&__j(".pmessenger-contact-a").length&&(__j("html").addClass("messenger-window"),setTimeout(function(){"none"!=__j("#profile_left_side_bar").css("display")&&__j("#profile_left_side_bar").hide(),__j(window).off("resize.restructureMessengerPage").on("resize.restructureMessengerPage",function(){resizeMessenger()}),resizeMessenger(),__j(".js_open_messenger-user").length?__j("#contact-"+parseInt(__j(".js_open_messenger-user").attr("id"))).trigger("click"):messenger.firstConvClick(),messenger.searchMessenger(),messenger._init(),__j(".pmessenger").show(),__j(".pmessenger-contact-a").length<=0&&(__j(".js_messenger_load_data").remove(),hasTouchStartEvent&&(__j(".js__smarphones_search").show(),messenger.show_contacts()))},10)):__j("html").removeClass("messenger-window"),__j(".wo_kb_msg_page").length||__j("html").removeClass("hide-vy-chat-tabs");const e=__j("#messenger-dark-mode-theme");readCookie("mode")&&"night"==readCookie("mode")?e.removeAttr("disabled"):(readCookie("mode")&&readCookie("mode"),e.attr("disabled",!0)),setTimeout(messengerPage,4e3)}function ajaxLoading(){var e=__j("body");e.find(".globalAjaxLoader").length||e.prepend('<div class="globalAjaxLoader">\t\t\t<div>        \t\t\t<div class="preloader-spin">            <div class="preloader-spin__petal"></div>            <div class="preloader-spin__petal"></div>            <div class="preloader-spin__petal"></div>            <div class="preloader-spin__petal"></div>            <div class="preloader-spin__petal"></div>            <div class="preloader-spin__petal"></div>            <div class="preloader-spin__petal"></div>            <div class="preloader-spin__petal"></div>            <div class="preloader-spin__petal"></div>            <div class="preloader-spin__petal"></div>            <div class="preloader-spin__petal"></div>            <div class="preloader-spin__petal"></div>\t\t\t</div></div>')}function removeAjaxLoad(){__j("body").find(".globalAjaxLoader").remove()}function is_smartphone(){var e=navigator.userAgent||navigator.vendor||window.opera;return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)}function getMobileOperatingSystem(){var e=navigator.userAgent||navigator.vendor||window.opera;return/windows phone/i.test(e)?"_windows":/android/i.test(e)?"_android":/iPad|iPhone|iPod/.test(e)&&!window.MSStream?"_ios":"_smartphone"}function resizeMessenger(){is_smartphone()?__j("html").addClass("_touch "+getMobileOperatingSystem()).removeClass("_hover _ms_desktop"):(__j("html").addClass("_hover _ms_desktop").removeClass("_touch "+getMobileOperatingSystem()),__j(".pmessenger").removeClass("show_contacts")),__j(".pmessenger").css("height",__j(window).height()-__j(".toolbar").outerHeight()+"px"),__j("#messenger-contacts-last,#messenger-contacts-search-res,#messenger-contacts-online-res").css("height",__j(window).height()-(__j(".toolbar").outerHeight()+__j(".pmessenger-contacts-header").height()+__j("._1nq2").height())+"px"),nanoScrollStart()}function modernPopup(e,n,o){if(__j("#sc_modern_popup").remove(),__j("body").prepend('<div id="sc_modern_popup" class="sc_modern_popup"><div class="sc_moder_popup_ovr"></div><div id="sc_modern_popup_cnt">\t\t<div class="modernPopup_scnt"></div>\t\t<div class="modernPopup-Confirm-footer">'+(n?"":'<div onclick="__j(\'#sc_modern_popup\').remove();" class="modernPopup-Confirm-button modernPopup-Confirm-button-cancel"> Cancel </div>')+'<div id="modernpopup-confirm-btn" class="modernPopup-Confirm-button">Ok</div></div>\t\t</div></div>'),e(__j("#modernpopup-confirm-btn"),__j(".modernPopup_scnt"),__j(".modernPopup-Confirm-button-cancel")),__j("#modernpopup-confirm-btn").on("click",function(e){__j("#sc_modern_popup").remove()}),o)return __j(".modernPopup_scnt").html('<div class="modern_popup_str">'+o+"</div>")}function updateSessionContacts(e){isInArray(e,my_contacts)||my_contacts.push(e)}function updateSessionGroups(e){isInArray(e,group_chats)||group_chats.push(e)}function urlencode(e){return encodeURIComponent(e)}function nanoScrollStart(){__j(".nano").nanoScroller({preventPageScrolling:!0,iOSNativeScrolling:!0}),__j(".nano").nanoScroller()}function connectIo(){return"localhost"!=window.location.hostname&&"127.0.0.1"!=window.location.hostname||console.log("%cWe can not create server connection from localhost","color: red; font-size:12px;"),"https:"!==location.protocol&&console.log("%cYou dont have SSL ENABLED, we can not connect to messenger server with http://. Please secure your domain with https://","color: red; font-size:12px;"),!!NODEJS_ENABLED&&io.connect(CHAT_NODE_HOST,{query:{key:messenger_code,domain:window.location.hostname,v:vy_ms_v},transports:["websocket"],reconnection:!0,reconnectionDelay:1e3,reconnectionAttempts:"Infinity",forceNew:!0})}function objHook(e){return void 0===e?void 0:validateJson(e.replace(/<!--/g,"").replace(/-->/g,""))}function generate_socket_id(e){return e.split("").reduce(function(e,n){return(e=(e<<5)-e+n.charCodeAt(0))&e},0)}function socketId(e){let n=e||_U.i;return md5(V_WS_ADDR+"_"+n)}function checkSafari(){let e=navigator.userAgent.indexOf("Chrome")>-1;return navigator.userAgent.indexOf("Safari")>-1&&!e}function confirm_act(e,n,o,t,r){call_confirm_popup=$.confirm({title:"",content:e,animation:"none",closeAnimation:"none",theme:"light",opacity:.5,buttons:{confirm:{text:r?r.confirm_button:o?lang.logout:lang.okay,btnClass:"btn-blue",action:function(){n&&n()}},cancel:{text:r?r.cancel_button:lang.cancel,action:function(){t&&t()}}}})}function tonum(e){return e.match(/\d/g).join("")}function removeValue(e,n,o){o=o||",";for(var t=e.split(o),r=0;r<t.length;r++)if(t[r]==n)return t.splice(r,1),t.join(o);return e}function validateJson(e,n){try{var o=JSON.parse(e);return o.hasOwnProperty("status"),"require_login"===o.status&&window.location.reload(),o}catch(e){return!1}}function controlWindowTab(){"_ios"==getMobileOperatingSystem()?setInterval(function(){let e=(new Date).getTime();e-vy_ms__mob_last_window_focus>1e3&&(vy_ms__window_tab_active=!0),vy_ms__mob_last_window_focus=e},500):__j(window).on("blur focus",function(e){if(__j(this).data("prevType")!=e.type)switch(e.type){case"blur":vy_ms__window_tab_active=!1;break;case"focus":vy_ms__window_tab_active=!0}__j(this).data("prevType",e.type)})}function jprintf(e,n){var o=arguments,t=1;return e.replace(/%((%)|s)/g,function(e){return e[2]||o[t++]})}function displayErr(e){var n='<div class="messenger-error-show js_mess-err-show"><div class="messenger-error-text">'+e+"</div></div>";__j(".pmessenger").length?__j("#pmessenger-contact-header").after(n):__j(".messenger-shortcut-container").length&&__j(".messenger-shortcut-container._focus .messenger-shortcut-header").after(n),ms__error_sound.play(),__j(".js_mess-err-show").addClass("showon"),setTimeout(function(){__j(".js_mess-err-show").removeClass("showon"),setTimeout(function(){__j(".js_mess-err-show").remove()},2e3)},6e3)}function iso8601(e){return e.getUTCFullYear()+"-"+(e.getUTCMonth()+1)+"-"+e.getUTCDate()+"T"+e.getUTCHours()+":"+e.getUTCMinutes()+":"+e.getUTCSeconds()+"Z"}function urldecode(e){return decodeURIComponent((e+"").replace(/\+/g,"%20"))}function base64_decode(e){var n,o,t,r,a,s,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=0,_=0,d=[];if(!e)return e;e+="";do{n=(s=i.indexOf(e.charAt(c++))<<18|i.indexOf(e.charAt(c++))<<12|(r=i.indexOf(e.charAt(c++)))<<6|(a=i.indexOf(e.charAt(c++))))>>16&255,o=s>>8&255,t=255&s,d[_++]=64==r?String.fromCharCode(n):64==a?String.fromCharCode(n,o):String.fromCharCode(n,o,t)}while(c<e.length);return d.join("").replace(/\0+$/,"")}function unbindRemainOnSite(e){e?__j(window).off("beforeunload."+e):__j(window).off("beforeunload"),stop_cl=!1,__j(window).bind("unload",function(){clearTimeout(beforeUnloadTimeout)})}function remainOnSite(e,n,o){stop_cl=e,__j(window).on("beforeunload."+n,function(){return beforeUnloadTimeout=setTimeout(function(){o&&o()},1e3),e})}function md5cycle(e,n){var o=e[0],t=e[1],r=e[2],a=e[3];o=ff(o,t,r,a,n[0],7,-680876936),a=ff(a,o,t,r,n[1],12,-389564586),r=ff(r,a,o,t,n[2],17,606105819),t=ff(t,r,a,o,n[3],22,-1044525330),o=ff(o,t,r,a,n[4],7,-176418897),a=ff(a,o,t,r,n[5],12,1200080426),r=ff(r,a,o,t,n[6],17,-1473231341),t=ff(t,r,a,o,n[7],22,-45705983),o=ff(o,t,r,a,n[8],7,1770035416),a=ff(a,o,t,r,n[9],12,-1958414417),r=ff(r,a,o,t,n[10],17,-42063),t=ff(t,r,a,o,n[11],22,-1990404162),o=ff(o,t,r,a,n[12],7,1804603682),a=ff(a,o,t,r,n[13],12,-40341101),r=ff(r,a,o,t,n[14],17,-1502002290),o=gg(o,t=ff(t,r,a,o,n[15],22,1236535329),r,a,n[1],5,-165796510),a=gg(a,o,t,r,n[6],9,-1069501632),r=gg(r,a,o,t,n[11],14,643717713),t=gg(t,r,a,o,n[0],20,-373897302),o=gg(o,t,r,a,n[5],5,-701558691),a=gg(a,o,t,r,n[10],9,38016083),r=gg(r,a,o,t,n[15],14,-660478335),t=gg(t,r,a,o,n[4],20,-405537848),o=gg(o,t,r,a,n[9],5,568446438),a=gg(a,o,t,r,n[14],9,-1019803690),r=gg(r,a,o,t,n[3],14,-187363961),t=gg(t,r,a,o,n[8],20,1163531501),o=gg(o,t,r,a,n[13],5,-1444681467),a=gg(a,o,t,r,n[2],9,-51403784),r=gg(r,a,o,t,n[7],14,1735328473),o=hh(o,t=gg(t,r,a,o,n[12],20,-1926607734),r,a,n[5],4,-378558),a=hh(a,o,t,r,n[8],11,-2022574463),r=hh(r,a,o,t,n[11],16,1839030562),t=hh(t,r,a,o,n[14],23,-35309556),o=hh(o,t,r,a,n[1],4,-1530992060),a=hh(a,o,t,r,n[4],11,1272893353),r=hh(r,a,o,t,n[7],16,-155497632),t=hh(t,r,a,o,n[10],23,-1094730640),o=hh(o,t,r,a,n[13],4,681279174),a=hh(a,o,t,r,n[0],11,-358537222),r=hh(r,a,o,t,n[3],16,-722521979),t=hh(t,r,a,o,n[6],23,76029189),o=hh(o,t,r,a,n[9],4,-640364487),a=hh(a,o,t,r,n[12],11,-421815835),r=hh(r,a,o,t,n[15],16,530742520),o=ii(o,t=hh(t,r,a,o,n[2],23,-995338651),r,a,n[0],6,-198630844),a=ii(a,o,t,r,n[7],10,1126891415),r=ii(r,a,o,t,n[14],15,-1416354905),t=ii(t,r,a,o,n[5],21,-57434055),o=ii(o,t,r,a,n[12],6,1700485571),a=ii(a,o,t,r,n[3],10,-1894986606),r=ii(r,a,o,t,n[10],15,-1051523),t=ii(t,r,a,o,n[1],21,-2054922799),o=ii(o,t,r,a,n[8],6,1873313359),a=ii(a,o,t,r,n[15],10,-30611744),r=ii(r,a,o,t,n[6],15,-1560198380),t=ii(t,r,a,o,n[13],21,1309151649),o=ii(o,t,r,a,n[4],6,-145523070),a=ii(a,o,t,r,n[11],10,-1120210379),r=ii(r,a,o,t,n[2],15,718787259),t=ii(t,r,a,o,n[9],21,-343485551),e[0]=add32(o,e[0]),e[1]=add32(t,e[1]),e[2]=add32(r,e[2]),e[3]=add32(a,e[3])}function cmn(e,n,o,t,r,a){return n=add32(add32(n,e),add32(t,a)),add32(n<<r|n>>>32-r,o)}function ff(e,n,o,t,r,a,s){return cmn(n&o|~n&t,e,n,r,a,s)}function gg(e,n,o,t,r,a,s){return cmn(n&t|o&~t,e,n,r,a,s)}function hh(e,n,o,t,r,a,s){return cmn(n^o^t,e,n,r,a,s)}function ii(e,n,o,t,r,a,s){return cmn(o^(n|~t),e,n,r,a,s)}function md51(e){txt="";var n,o=e.length,t=[1732584193,-271733879,-1732584194,271733878];for(n=64;n<=e.length;n+=64)md5cycle(t,md5blk(e.substring(n-64,n)));e=e.substring(n-64);var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(n=0;n<e.length;n++)r[n>>2]|=e.charCodeAt(n)<<(n%4<<3);if(r[n>>2]|=128<<(n%4<<3),n>55)for(md5cycle(t,r),n=0;n<16;n++)r[n]=0;return r[14]=8*o,md5cycle(t,r),t}function md5blk(e){var n,o=[];for(n=0;n<64;n+=4)o[n>>2]=e.charCodeAt(n)+(e.charCodeAt(n+1)<<8)+(e.charCodeAt(n+2)<<16)+(e.charCodeAt(n+3)<<24);return o}var hex_chr="0123456789abcdef".split("");function rhex(e){for(var n="",o=0;o<4;o++)n+=hex_chr[e>>8*o+4&15]+hex_chr[e>>8*o&15];return n}function hex(e){for(var n=0;n<e.length;n++)e[n]=rhex(e[n]);return e.join("")}function md5(e){return hex(md51(e))}function add32(e,n){return e+n&4294967295}if("5d41402abc4b2a76b9719d911017c592"!=md5("hello"))function add32(e,n){var o=(65535&e)+(65535&n);return(e>>16)+(n>>16)+(o>>16)<<16|65535&o}soundManager.setup({url:THEME_URL+"/javascript/vaneayoung/soundmanager",flashVersion:9,autoLoad:!0,debugMode:!1,preferFlash:!1,onready:function(){ms__new_message=soundManager.createSound({id:"new-message",url:THEME_URL+"/javascript/vaneayoung/sounds/new_message.mp3?v2",volume:100,autoPlay:!1,type:"audio/mp3"}),ms__tap=soundManager.createSound({id:"tap",url:THEME_URL+"/javascript/vaneayoung/sounds/tap.aac",volume:100,autoPlay:!1,type:"audio/aac"}),ms__send_message=soundManager.createSound({id:"send_message",url:THEME_URL+"/javascript/vaneayoung/sounds/snap.aac",volume:50,autoPlay:!1,type:"audio/aac"}),ms__test_sound=soundManager.createSound({id:"ms_test_sound",url:THEME_URL+"/javascript/vaneayoung/sounds/snap.aac",volume:0,autoPlay:!0,type:"audio/aac",muted:!0,onfinish:function(){this.destruct()}}),ms__error_sound=soundManager.createSound({id:"error_sound",url:THEME_URL+"/javascript/vaneayoung/sounds/error.wav",volume:100,autoPlay:!1,type:"audio/wav"})},ontimeout:function(){}}),__j(document).ready(function(){messengerPage(),setTimeout(function(){controlWindowTab()},1e3)}),$.fn.focusEnd=function(){__j(this).focus();var e=__j("<span />").appendTo($(this)),n=e.get(0),o=null,t=null;return document.selection?((o=document.body.createTextRange()).moveToElementText(n),o.select()):window.getSelection&&((o=document.createRange()).selectNode(n),(t=window.getSelection()).removeAllRanges(),t.addRange(o)),e.remove(),this};