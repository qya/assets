function vy_webrtc_calls(){var s;void 0===s&&(s=function(e){return $(e)}),$.fn.extend({center:function(){return this.each(function(){var e=($(window).height()-$(this).outerHeight())/2,t=($(window).width()-$(this).outerWidth())/2;$(this).css({position:"absolute",margin:0,top:(0<e?e:0)+"px",left:(0<t?t:0)+"px"})})}});var i=this;i.peer_uniq_id=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),i.ajax_url=V_HOST+"/messenger.php",i.curr_peer_id,i.last_peer_id=0,i.reconnectPeerTimeout,i.reconnectPeerTimesCount=20,i.peerJS_reconnect_times=0,i.peer,i.call,i.localStream,i.socket=sio,i.recipientid,i.media_type,i.body=s("body"),i.close_button,i.hangup_button,i.answer_button,i.call_window,i.recipient_media_element,i.user_media_element,i.peer_conn,i.status,i.timer,i.total_time=!1,i.call_initiated=!1,i.ms__contacting_sound,i.ms__ringing_sound,i.ms__incomming_call,i.ms___test_sound,i.timer_interval,i.header_status,i.socket_notif_created,i.callerid=0,i.mob_last_window_focus=(new Date).getTime(),i.smartphone_focus_timeout,i.ios_simulated="no",i.call_1_ended,i.ringing_timeout,i.close_call_click_timeout,i.last_message_send,i.busy_status_timeout,i._call_start_timeout,i.playing_music_plugin,i.media_elements,i.call_start_now,i.microphone_camera_err_msg="<br/>Please make sure your microphone and camera are enabled.",i.setTime=function(){},this.stop_music_plugin=function(){$.socplusMusic&&$.socplusMusic("is_playing")&&($.socplusMusic("pause_playing"),i.playing_music_plugin=1)},this.play_music_plugin=function(){$.socplusMusic&&i.playing_music_plugin&&($.socplusMusic("continue_playing"),i.playing_music_plugin=!1)},this.makeCall=function(e,t,n){e&&evstop(e,1),clearTimeout(i._call_start_timeout),i.call_start_now||(i.start_call(t,n),i.call_start_now=1),i._call_start_timeout=setTimeout(function(){i.call_start_now=!1},2e3)},this.call_popup=function(e,t){i.media_type=e,i.recipientid=t,i.callerid=_U.i,i.total_time,i.call_1_ended=!1,i.ringing_timeout=!1,i.call_initiated=1,i.create_sounds(function(){i._call_popup()}),i.stop_music_plugin()},this.answer_popup=function(e){i.media_type=e.metadata.call_type,i.recipientid=e.metadata.user_id,i.callerid=e.metadata.user_id,i.total_time,i.call_1_ended=!1,i.ringing_timeout=!1,i.call_initiated=1,i.call=e,i.create_sounds(function(){i._answer_popup(e)}),i.stop_music_plugin()},this._answer_popup=function(t){if(i.body.find("#vy_call_popup").length)i.focusCallWindow();else{const e=jAjax(i.ajax_url,"post",{cmd:"answer-popup",metadata:JSON.stringify(t.metadata)});e.done(function(e){i.call_window=s(e);e=i.call_window;i.body.prepend(e),i.status=e.find("#vy_calling_status"),i.header_status=e.find("#vy_ms__header_status"),i.close_button=e.find("#vy_ms__close_buttonevent"),i.hangup_button=e.find("#vy_ms__decline_buttonevent"),i.answer_button=e.find("#vy_ms__answer_buttonevent"),i.media_elements=e.find("#vy_ms_wbrtc_mediaelement"),i.play_sound("incoming"),i.socket.emit("call_user_connected",socketId(t.metadata.user_id)),i.get_notifications(t.metadata),i.addEventsToPopup(e)})}},this._call_popup=function(){if(i.body.find("#vy_call_popup").length)i.focusCallWindow();else{const e=jAjax(i.ajax_url,"post",{cmd:"call-popup",recipient:escape(i.recipientid),media_type:i.media_type});e.done(function(e){i.call_window=s(e);e=i.call_window;i.body.prepend(e),i.status=e.find("#vy_calling_status"),i.header_status=e.find("#vy_ms__header_status"),i.close_button=e.find("#vy_ms__close_buttonevent"),i.hangup_button=e.find("#vy_ms__decline_buttonevent"),i.answer_button=e.find("#vy_ms__answer_buttonevent"),i.media_elements=e.find("#vy_ms_wbrtc_mediaelement"),i.addEventsToPopup(e),i.initiateCall(i.media_type,i.recipientid,i.localStream)})}},this.addEventsToPopup=function(t){t.find("#vy_call_halfmin_btn").off("click.halfminimizeMessCallWindow").on("click.halfminimizeMessCallWindow",function(e){evstop(e),t.addClass("likeclose"),i.enableDrag(t),i.enableResize(t)}),t.find("#vy_call_halfmaximize_btn").off("click.halfmaximizeMessCallWindow").on("click.halfmaximizeMessCallWindow",function(e){evstop(e),t.removeClass("likeclose").find("div:first").removeAttr("style"),i.disableDrag(t),i.disableResize(t)}),t.find("#vy_call_min_btn").off("click.minimizeMessengerCallWindow").on("click.minimizeMessengerCallWindow",function(e){evstop(e),t.addClass("likeclose minimized"),is_smartphone()?t.find("#vy_call_js_draggable").removeAttr("style").center():t.find("#vy_call_js_draggable").removeAttr("style").css({right:"15px",bottom:"15px"}),i.enableDrag(t),i.disableResize(t)}),t.find("#vy_call_maximize_btn").off("click.maximizeMessengerCallWindow").on("click.maximizeMessengerCallWindow",function(e){evstop(e),is_smartphone()?(t.removeClass("likeclose minimized"),t.find("#vy_call_js_draggable").center()):(t.removeClass("minimized"),t.find("#vy_call_js_draggable").center(),i.enableResize(t))}),t.find("#vy_ms__answer_buttonevent").off("click.vy_ms__ANSWER_EVENT").on("click.vy_ms__ANSWER_EVENT",function(e){evstop(e,1),i.answerThisCall(t),this.remove()}),t.find("#vy_ms__decline_buttonevent").off("click.vy_ms__ENDCALL_EVENT").on("click.vy_ms__ENDCALL_EVENT",function(e){evstop(e,1),i.destroyThisCall(this,t)}),t.find("#vy_ms__close_buttonevent").off("click.vy_ms__CLOSE_EVENT").on("click.vy_ms__CLOSE_EVENT",function(e){evstop(e,1),i.destroyThisCall(this,t)}),is_smartphone()&&t.find("#vy_call_halfmin_btn").remove()},this.answerThisCall=async function(e){if(!navigator.mediaDevices)return i.browser_dosent_support_mediadevice();i.stop_sound("incoming"),i.call_status("answered");var t="audio"==i.media_type?{audio:!0,video:!1}:{audio:!0,video:{facingMode:"user"}};await navigator.mediaDevices.getUserMedia(t).then(e=>{i.localStream=e,i.socket.emit("call_answered",socketId(i.call.metadata.user_id)),i.createAnswer()}).catch(function(e){i.show_error_popup(e+"."+i.microphone_camera_err_msg),i.call_ended("error",!1,e),i.socket.emit("call_unavailable_stream",socketId(i.recipientid))})},this.createAnswer=function(e){s("#vy_ms__decline_buttonevent").removeClass("__reject").addClass("__endcall"),i.media_elements.removeClass("__none"),is_smartphone()&&i.media_elements.addClass("_mobileview"),i.media_elements.find("#vy-ms__user-video-element").draggable(),i.set_media_elements(i.media_type),i.user_media_element[0].srcObject=i.localStream,i.call.answer(i.localStream),i.call.on("stream",function(e){"video"==i.media_type&&i.call_window.addClass("vy_ms__videocall"),setTimeout(function(){i.recipient_media_element[0].srcObject=e,i.recipient_media_element[0].onloadedmetadata=function(e){i.socket.emit("call_started",socketId(i.call.metadata.user_id)),i.call_established(),i.start_timer()}},100)}),i.call.on("close",function(){i.call_ended("finished")})},this.start_timer=function(){clearTimeout(i.timer_interval);let e,t,n,s=0;i.setTime=function(){++s,e=Math.floor(s/3600),t=Math.floor((s-3600*e)/60),n=s-(3600*e+60*t),e<10&&(e="0"+e),t<10&&(t="0"+t),n<10&&(n="0"+n),i.total_time=e+":"+t+":"+n,i.status.text(i.total_time),i.set_header_status(i.total_time),i.timer_interval=setTimeout(i.setTime,1e3),navigator.onLine||i.show_err_msg("network")},i.setTime()},this.set_header_status=function(e){i.header_status.html("&nbsp;&#9866;&nbsp;"+e)},this.destroy_timer=function(){clearTimeout(i.timer_interval),i.setTime=function(){}},this.destroyThisCall=function(e,t){var n=!!(e=s(e)||!1)&&e.hasClass("__callinitiator");e&&e.hasClass("__reject")?i.call_ended("rejected",n):e&&e.hasClass("__endcall")&&!e.hasClass("__reject")&&i.call_ended("finished",n),i.localStream&&("video"==i.media_type&&i.localStream.getVideoTracks()[0].stop(),i.localStream.getAudioTracks()[0].stop(),i.localStream=!1),i.stop_sound("all"),i.destroy_timer(),i.call&&i.call.close(),i.disableResize(t),i.disableDrag(t),i.destroy_sounds(),setTimeout(function(){t.remove(),i.set_peer_status("available")},10),i.callerid=0,i.total_time=!1,i.call_initiated=!1,clearTimeout(i.close_call_click_timeout),clearTimeout(i.busy_status_timeout),i.play_music_plugin()},this.set_peer_status=function(e){jAjax(i.ajax_url,"post",{cmd:"set-peer-status",action:e})},this.focusCallWindow=function(){i.call_window.removeClass("minimized").addClass("likeclose"),i.call_window.find("#vy_call_js_draggable").center(),i.enableResize(i.call_window),i.enableDrag(i.call_window)},this.enableDrag=function(e){const t=e.find("#vy_call_js_draggable");t.is(":data(ui-draggable)")||t.draggable({handle:"#vy_js_calls_header",scroll:!1})},this.disableDrag=function(e){const t=e.find("#vy_call_js_draggable");t.is(":data(ui-draggable)")&&t.draggable("destroy")},this.enableResize=function(e){const t=e.find("#vy_call_js_draggable");t.is(":data(ui-resizable)")||t.resizable({handles:"n, e, s, w, se, nw",minHeight:450,minWidth:190})},this.disableResize=function(e){const t=e.find("#vy_call_js_draggable");t.is(":data(ui-resizable)")&&t.resizable("destroy")},this.peer_open=function(e){i.last_peer_id=e},this.peer_disconnected=function(){clearTimeout(i.reconnectPeerTimeout),i.peer.id=i.last_peer_id,i.peer._lastServerId=i.last_peer_id,i.peerJS_reconnect_times<=i.reconnectPeerTimesCount?i.reconnectPeerTimeout=setTimeout(function(){i.peer.reconnect(),i.peerJS_reconnect_times++},5e3):(clearTimeout(i.reconnectPeerTimeout),console.log("Sorry, the system can not connect to peerJS, this mean your video/audio calling will not work."),i.set_peer_status("cant_receive_signal"))},this.checkSafari=function(){var e=-1<navigator.userAgent.indexOf("Chrome");return-1<navigator.userAgent.indexOf("Safari")&&!e},this.connect=function(){i.peer=new Peer(i.peer_uniq_id,{license:{code:messenger_code,domain:window.location.hostname,v:vy_ms_v},host:PEER_HOST_NAME,port:PEER_PORT,key:"peerjs",reconnectTimer:1e3,serialization:"json",iceTransportPolicy:"relay",debug:0,path:PEER_PATH,metadata:{user_name:_U.fn,user_avatar:_U.p,user_id:_U.i,peer_id:i.peer_uniq_id},config:{iceServers:[{url:iceservers_stun,credential:iceservers_cr,username:iceservers_un},{url:iceservers_turn,credential:iceservers_cr,username:iceservers_un}]}}),i.peer.on("open",i.peer_open),i.peer.on("disconnected",i.peer_disconnected),i.socket.emit("update_peer_id",JSON.stringify({Userid:socketId(_U.i),Peer_id:i.peer_uniq_id})),i.peer.on("open",function(e){console.log(e),i.update_peer_id(e),i.set_peer_status("available")}),i.peer.on("close",function(e,t,n,s){console.log("Close: declined")}),i.peer.on("connection",function(e){}),i.peer.on("call",function(e){i.answer_popup(e),i.set_peer_status("another_call")}),i.peer.on("error",function(e){jAjax(i.ajax_url,"post",{cmd:"logerr",err:JSON.stringify(e)});i.show_err_msg(e.type)}),i.mob_last_window_focus=(new Date).getTime(),s(window).off("unload.vy-ms__offline_peer beforeunload.vy-ms__offline_peer").on("unload.vy-ms__offline_peer beforeunload.vy-ms__offline_peer",function(){return vy_calls.peerIsOffline()}),i.enable_sounds_for_ios()},this.peerIsOffline=function(){i.set_peer_status("offline"),i.total_time?i.call_ended("finished"):i.call_ended("rejected")},this.show_err_msg=function(e){switch(e){case"browser-incompatible":i.call_ended("error",!1,"The client's browser does not support some or all WebRTC features that you are trying to use.");break;case"disconnected":i.call_ended("error",!1,"Disconnected from the server."),i.reconnectPeer();break;case"invalid-id":i.call_ended("error",!1,"An tehnical error ocurred.[INVALID ID]");break;case"network":i.call_ended("error",!1,"Network down. Lost or cannot establish a connection to the signalling server.");break;case"peer-unavailable":i.call_ended("notif",!1,"The user can not receive calls at the moment, try again later.");break;case"server-error":i.call_ended("error",!1,"Unable to reach the server.");break;case"socket-error":i.call_ended("error",!1,"An error from the underlying socket.");break;case"socket-closed":i.call_ended("error",!1,"The underlying socket closed unexpectedly.");break;case"unavailable-id":i.peer.disconnect(),i.reconnectPeer(),i.call_ended("notif",!1,"The user can not be reached at the moment, please try to reload your page.. and try again.");break;case"webrtc":i.call_ended("error",!1,"Tehnical error. Native WebRTC errors.")}},this.update_peer_id=function(e){const t=jAjax(i.ajax_url,"post",{cmd:"update-peer-id",id:e});t.done(function(e){})},this.enable_sounds_for_ios=function(){i.ms___test_sound=soundManager.createSound({id:"ms__test_sound",url:THEME_URL+"/javascript/vaneayoung/sounds/tap.aac",volume:0,autoPlay:!1,type:"audio/aac",onload:function(){i.ios_simulated="yes",this.destruct()}}),soundManager.onready(function(){soundManager.load("ms__test_sound")}),is_smartphone()&&s(document).off("touchstart.simulateIosAudio click.simulateIosAudio").on("touchstart.simulateIosAudio click.simulateIosAudio",function(){return"yes"==i.ios_simulated?(s(document).off("touchstart.simulateIosAudio click.simulateIosAudio"),!1):void("function"==typeof i.ms___test_sound&&i.ms___test_sound.play())})},this.reconnectPeer=function(){i.peer.connect(i.peer_uniq_id,{license:{code:messenger_code,domain:window.location.hostname},host:PEER_HOST_NAME,port:PEER_PORT,debug:!1,metadata:{user_name:_U.fn,user_avatar:_U.p,user_id:_U.i,peer_id:i.peer_uniq_id}})},this.disconnectPeer=function(){i.peer&&i.peer.disconnect()},this.browser_dosent_support_mediadevice=async function(){ajaxLoading();const e=jAjax(i.ajax_url,"post",{cmd:"call-error",msg:"Your browser dose not support Video/Audio calls."});e.done(function(e){removeAjaxLoad(),i.body.find("#vy-ms__call_error_popup_info").remove(),i.body.prepend(e)}),i.close_button.trigger("click"),i.socket.emit("call_unavailable_stream",socketId(i.recipientid))},this.show_error_popup=function(e){$.confirm({title:"Disabled or not supported.",content:e,type:"red",typeAnimated:!0,buttons:{close:function(){}}}),i.close_button&&i.close_button.trigger("click")},this.start_call=async function(t,n){if(!navigator.mediaDevices)return i.browser_dosent_support_mediadevice();var e="audio"==t?{audio:!0,video:!1}:{audio:!0,video:!0};await navigator.mediaDevices.getUserMedia(e).then(e=>{i.localStream=e,i.call_popup(t,n)}).catch(function(e){i.show_error_popup(e+"."+i.microphone_camera_err_msg),i.call_ended("error",!1,e)})},this.set_media_elements=function(e){i.recipient_media_element=s("video"==e?"#vy-ms__recipient-video-element":"#vy-ms__recipient-audio-element"),i.user_media_element=s("video"==e?"#vy-ms__user-video-element":"#vy-ms__user-audio-element")},this.initiateCall=function(n,e,s){i.set_media_elements(n),jAjax(i.ajax_url,"post",{cmd:"initiate-call",type:n,recipient:escape(e)}).done(function(e){var t=validateJson(e);if(1<=t.blacklist)return i.call_ended("blacklist");if(t.peer_id<=0)return i.userNotConnected();if("another_call"==t.status)return i.call_ended("another_call");if("offline"==t.status)return i.call_ended("offline");if("cant_receive_signal"==t.status)return i.call_ended("cant_receive_signal");e={metadata:{user_name:_U.fn,user_avatar:_U.p,user_id:_U.i,call_type:n},constraints:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}}};i.play_sound("contacting"),setTimeout(function(){i.user_media_element[0].srcObject=s},100),i.media_elements.removeClass("__none"),is_smartphone()&&i.media_elements.addClass("_mobileview"),i.media_elements.find("#vy-ms__user-video-element").draggable(),i.set_peer_status("another_call"),i.call=i.peer.call(t.peer_id,s,e),i.call.on("stream",function(e){i.getRecipientStream(e)}),i.call.on("error",function(e){i.set_peer_status("available")}),i.get_notifications(i.call.metadata)})},this.getRecipientStream=function(e){i.set_media_elements(i.media_type),i.recipient_media_element[0].srcObject=e,"video"==i.media_type&&i.call_window.addClass("vy_ms__videocall")},this.stop_sound=function(e,t){switch(e){case"contacting":setTimeout(function(){i.ms__contacting_sound.stop()},10);break;case"ringing":setTimeout(function(){i.ms__ringing_sound.stop()},10);break;case"incoming":setTimeout(function(){i.ms__incomming_call.stop()},10);break;case"busy":setTimeout(function(){i.ms__busy_sound.stop()},10);break;case"noanswer":setTimeout(function(){i.ms__noanswer_sound.stop()},10);break;case"all":setTimeout(function(){i.ms__contacting_sound.stop(),i.ms__ringing_sound.stop(),i.ms__incomming_call.stop(),i.ms__busy_sound.stop(),i.ms__noanswer_sound.stop()},10)}t||setTimeout(function(){i.stop_sound_propagate(e)},1500)},this.stop_sound_propagate=function(e){return i.stop_sound(e,1)},this.play_sound=function(e){switch(e){case"contacting":i.ms__contacting_sound.play();break;case"ringing":i.ms__ringing_sound.play();break;case"incoming":i.ms__incomming_call.play();break;case"busy":i.ms__busy_sound.play();break;case"noanswer":i.ms__noanswer_sound.play()}},this.create_sounds=function(e){i.ms__incomming_call=soundManager.createSound({id:"ms_call_incoming",url:THEME_URL+"/javascript/vaneayoung/sounds/incoming_call.mp3",volume:100,autoPlay:!1,onfinish:function(){this.play()}}),i.ms__ringing_sound=soundManager.createSound({id:"ms_call_ringing",url:THEME_URL+"/javascript/vaneayoung/sounds/call-ringing-2s.mp3",volume:100,autoPlay:!1,type:"audio/mp3",onfinish:function(){var e=this;setTimeout(function(){e.play()},900)}}),i.ms__contacting_sound=soundManager.createSound({id:"ms_call_contacting",url:THEME_URL+"/javascript/vaneayoung/sounds/call-connecting.mp3",volume:100,autoPlay:!1,type:"audio/mp3",onfinish:function(){this.play()}}),i.ms__busy_sound=soundManager.createSound({id:"ms_call_busy",url:THEME_URL+"/javascript/vaneayoung/sounds/call-busy.mp3",volume:100,autoPlay:!1,type:"audio/mp3"}),i.ms__noanswer_sound=soundManager.createSound({id:"ms_call_noansnwer",url:THEME_URL+"/javascript/vaneayoung/sounds/call-noanswer.mp3",volume:100,autoPlay:!1,type:"audio/mp3"}),soundManager.onready(function(){soundManager.load("ms_call_incoming"),soundManager.load("ms_call_ringing"),soundManager.load("ms_call_contacting"),soundManager.load("ms_call_busy"),soundManager.load("ms_call_noansnwer"),"function"==typeof e&&e()})},this.destroy_sound=function(e,t){t&&(i.destroy_sounds(),i.create_sounds())},this.destroy_sounds=function(){soundManager.stopAll(),i.ms__contacting_sound.destruct(),i.ms__ringing_sound.destruct(),i.ms__incomming_call.destruct(),i.ms__busy_sound.destruct(),i.ms__noanswer_sound.destruct()},this.call_status=function(e,t,n){function s(e,t){t=t||e,i.set_header_status(t),i.status.text(e)}switch(e){case"connecting":s(lang["Call_Contacting..."]);break;case"rejected":s(lang.Call_rejected),i.call_ended("rejected");break;case"reject_status":s("I'm Busy! I call you back later.","Busy");break;case"started":s(t);break;case"callended":s(lang.call_ended,t);break;case"no_answer":s(lang.call_no_answer,lang.call_no_answer);break;case"another_call":s("Is on another call.","Line Busy");break;case"ringing":s(lang["Call_Ringing..."]);break;case"disconected":s("Recipient is disconnected.","Disconnected");break;case"answered":s(lang["Call_Connecting..."]);break;case"offline":s("I'm offline, i will call back soon.","Offline");break;case"unavailable_stream":s(lang.call_recipient_err_stream.replace("%uname",n.user_name).replace("%calltype",n.call_type),"Call ended."),i.call_ended("no_stream")}},this.call_established=function(){is_smartphone()||s("#vy_call_halfmin_btn").trigger("click.halfminimizeMessCallWindow")},this.get_notifications=function(t){i.socket_notif_created||(i.socket_notif_created=1,i.socket.on("call_user_connected",function(e){i.call_1_ended||(i.stop_sound("contacting"),i.play_sound("ringing"),i.call_status("ringing"),i.ringing_timeout=setTimeout(function(){i.call_ended("no-answer",1)},6e4))}),i.socket.on("call_rejected",function(e){i.call_status("rejected")}),i.socket.on("call_answered",function(e){i.stop_sound("all"),i.call_status("answered")}),i.socket.on("call_unavailable_stream",function(e){i.call_status("unavailable_stream",!1,t)}),i.socket.on("call_started",function(e){setTimeout(function(){i.stop_sound("ringing"),i.stop_sound("all")},100),i.start_timer(),i.call_established(),i.ringing_timeout&&clearTimeout(i.ringing_timeout)}),i.socket.on("call_finished",function(e){i.call_ended("finished")}),i.socket.on("call_stopped",function(e){i.call_ended("finished")}))},this.call_ended=function(e,t,n){!i.call_1_ended&&i.call_initiated&&(i.timer_interval&&clearTimeout(i.timer_interval),"blacklist"==e&&(setTimeout(function(){i.play_sound("busy")},50),i.busy_status_timeout=setTimeout(function(){i.set_header_status("Blacklisted"),i.status.text("You can not call this user. You are in blacklist.")},100),i.close_call_click_timeout=setTimeout(function(){i.stop_sound("all"),i.close_button.trigger("click")},9e3)),"rejected"==e&&(setTimeout(function(){i.stop_sound("ringing"),i.play_sound("busy")},100),i.socket.emit("call_rejected",socketId(i.recipientid)),i.busy_status_timeout=setTimeout(function(){i.call_status("reject_status")},1500),i.close_call_click_timeout=setTimeout(function(){i.stop_sound("all"),i.close_button.trigger("click")},9e3)),"another_call"==e&&(setTimeout(function(){i.stop_sound("all",1),i.play_sound("busy")},50),i.busy_status_timeout=setTimeout(function(){i.call_status("another_call")},100),i.sendMessage("missed"),i.close_call_click_timeout=setTimeout(function(){i.stop_sound("all"),i.close_button.trigger("click")},9e3)),"cant_receive_signal"==e&&(setTimeout(function(){i.stop_sound("all",1),i.play_sound("busy")},50),i.busy_status_timeout=setTimeout(function(){i.call_status("disconected")},100),i.sendMessage("missed"),i.close_call_click_timeout=setTimeout(function(){i.stop_sound("all"),i.close_button.trigger("click")},9e3)),"offline"==e&&(setTimeout(function(){i.play_sound("busy")},50),i.busy_status_timeout=setTimeout(function(){i.call_status("offline")},100),i.sendMessage("missed"),i.close_call_click_timeout=setTimeout(function(){i.stop_sound("all"),i.close_button.trigger("click")},9e3)),"no-answer"==e&&(setTimeout(function(){i.stop_sound("ringing"),i.play_sound("noanswer")},100),i.socket.emit("call_stopped",socketId(i.recipientid)),setTimeout(function(){i.call_status("no_answer")},150),i.close_call_click_timeout=setTimeout(function(){i.stop_sound("all"),i.close_button.trigger("click")},18e3)),"error"!=e&&"notif"!=e||(setTimeout(function(){i.stop_sound("all",1),i.play_sound("busy")},50),i.busy_status_timeout=setTimeout(function(){i.set_header_status("error"==e?"Error":"Call finished"),i.status.text(n)},100),i.close_call_click_timeout=setTimeout(function(){i.stop_sound("all"),i.close_button.trigger("click")},9e3)),"no_stream"==e&&(setTimeout(function(){i.stop_sound("all",1),i.play_sound("busy")},50),i.close_call_click_timeout=setTimeout(function(){i.stop_sound("all"),i.close_button.trigger("click")},9e3)),"finished"==e&&(setTimeout(function(){i.stop_sound("ringing"),i.stop_sound("all")},100),i.call_status("callended",i.total_time),i.socket.emit("call_finished",socketId(i.recipientid)),i.close_call_click_timeout=setTimeout(function(){i.close_button.trigger("click")},3e3)),i.hangup_button.hasClass("__callinitiator")&&("finished"==e&&i.total_time?i.sendMessage("ended",i.total_time):i.sendMessage("missed")),i.call_window.removeClass("vy_ms__videocall"),i.answer_button.hide(),i.hangup_button.hide(),i.close_button.show(),i.call&&i.call.close(),i.call_1_ended=1)},this.sendMessage=function(n,s){if(!i.last_message_send){let e,t=window.event||$.Event();switch(n){case"missed":e="[missedcall]"+_U.i+"-"+i.recipientid+"-"+i.media_type+"[/missedcall]";break;case"ended":e="[callended]"+_U.i+"-"+i.recipientid+"-"+i.media_type+"-"+s+"[/callended]"}e&&messenger.send(0,t,e,i.recipientid),i.last_message_send=1,setTimeout(function(){i.last_message_send=0},3e3)}},this.userNotConnected=function(){i.call_ended("cant_receive_signal")}}